name: workflow-file-lock

on:
  pull_request:
    paths:
      - '.github/workflows/**'
    types: [opened, reopened, synchronize, ready_for_review, edited]

concurrency:
  group: workflow-file-lock
  cancel-in-progress: false

jobs:
  hold-lock:
    runs-on: ubuntu-latest
    steps:
      - name: Ensure origin/main is available (avoid no merge base)
        run: |
          echo "Starting git fetch for origin/main"
          # attempt to fetch origin/main; tolerate failure so job doesn't error
          git fetch origin main --no-tags || true
          echo "Git fetch completed"
          # if origin/main exists, show the merge-base; if not, continue safely
          if git rev-parse --verify origin/main >/dev/null 2>&1; then
            echo "origin/main found. Checking merge-base:"
            git merge-base origin/main HEAD || true
            echo "Merge-base check completed"
          else
            echo "origin/main not found; skipping merge-base check."
          fi
          echo "Step completed successfully"

      - name: No-op safe completion
        run: |
          echo "Workflow-file-lock: starting final step"
          echo "Workflow-file-lock: completed safely."
          echo "Final step completed"
